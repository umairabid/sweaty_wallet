<div id="transactions-page" data-controller="transactions--index">
  <div class="block items-center justify-between border-b border-gray-200 bg-white p-4 dark:border-gray-700 dark:bg-gray-800 sm:flex">
    <div class="mb-1 w-full">
      <div class="mb-4">
        <%= render 'helpers/breadcrumbs', crumbs: [['Transactions']] %>
        <h1 class="text-xl font-semibold text-gray-900 sm:text-2xl">Your Transactions</h1>
      </div>
      <div class="sm:flex">
        <div class="mb-3 hidden items-center dark:divide-gray-700 sm:mb-0 sm:flex sm:divide-gray-100">
          <%= form_for :filter, url: transactions_path, method: :get do |f| %>
            <%= f.text_field :query, placeholder: 'Search for transactions', class: 'block w-full border disabled:cursor-not-allowed disabled:opacity-50 bg-gray-50 border-gray-300 text-gray-900 rounded-lg p-2.5 text-sm' %>
            <input type="hidden" name="page" value="1">
            <div id="advance-search-drawer"  class="fixed top-0 right-0 z-40 h-screen p-4 overflow-y-auto transition-transform translate-x-full bg-white w-80">
              <h5 id="drawer-label" class="inline-flex items-center mb-6 text-base font-semibold text-gray-500 uppercase">Search Transactions</h5>
              <button type="button" class="text-gray-400 bg-transparent hover:bg-gray-200 hover:text-gray-900 rounded-lg text-sm w-8 h-8 absolute top-2.5 end-2.5 inline-flex items-center justify-center" >
                <%= render "icons/cross" %>
                <span class="sr-only">Close menu</span>
              </button>
              <div class="mb-6">
                <%= f.label :time_range, 'Time Range', class: 'block mb-2 text-sm font-medium text-gray-900' %>
                <%= f.select :time_range, @filter.selects[:time_ranges], {}, class: 'bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5' %>
              </div>
              <div class="mb-6">
                <%= f.label :account_type, 'Account Type', class: 'block mb-2 text-sm font-medium text-gray-900' %>
                <%= f.select :account_type, @filter.selects[:account_types], {}, class: 'bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5' %>
              </div>
              <div class="mb-6">
                <%= f.label :account_id, 'Account', class: 'block mb-2 text-sm font-medium text-gray-900' %>
                <%= f.select :account_id, @filter.selects[:accounts], {}, class: 'bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5' %>
              </div>
              <div class="mb-6">
                <%= f.label :bank, 'Bank', class: 'block mb-2 text-sm font-medium text-gray-900' %>
                <%= f.select :bank, @filter.selects[:banks], {}, class: 'bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5' %>
              </div>
              <div class="mb-6">
                <%= f.label :type, 'Type', class: 'block mb-2 text-sm font-medium text-gray-900' %>
                <%= f.select :type,@filter.selects[:types], {}, class: 'bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5' %>
              </div>
              <div class="mb-6">
                <%= f.label :categories, 'Category', class: 'block mb-2 text-sm font-medium text-gray-900' %>
                <%= f.select :categories, @filter.selects[:categories], {}, multiple: true, class: 'bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5' %>
              </div>
              <div class="flex items-center justify-end">
                <button type="button" class="py-2.5 px-5 text-sm font-medium text-gray-900 bg-white rounded-lg border border-gray-200 ">Decline</button>
                <%= f.submit "Apply", class: 'cursor-pointer ms-3 text-white bg-blue-700 font-medium rounded-lg text-sm px-5 py-2.5 text-center' %>
              </div>
            </div>
          <% end %>
          <div class="mt-3 flex space-x-1 pl-0 sm:mt-0 sm:pl-2">
            <button data-action="click->transactions--index#open_search" class="inline-flex cursor-pointer justify-center rounded p-1 text-gray-500 hover:bg-gray-100 hover:text-gray-900">
              <span class="sr-only">Configure</span>
              <%= render 'icons/gear' %>
            </button>
          </div>
        </div>
        <div class="ml-auto flex items-center space-x-2 sm:space-x-3">
          <button class="text-white bg-primary-700 hover:bg-primary-800 p-0 font-medium rounded-lg" type="button">
            <span class="flex items-center rounded-md text-sm px-3 py-2">
              <div class="flex items-center gap-x-3"><%= render 'icons/plus' %> Add Transaction</div>
            </span>
          </button>
          <a href="<%= export_transactions_path(filter: (params[:filter] ? params[:filter].to_unsafe_h : {})) %>" data-turbo-stream class="text-gray-900 bg-white border border-gray-200 hover:bg-gray-100 hover:text-blue-700 disabled:hover:bg-white p-0 font-medium rounded-lg" type="button">
            <span class="flex items-center rounded-md text-sm px-3 py-2">
              <div class="flex items-center gap-x-3"><%= render 'icons/export' %> Export</div>
            </span>
          </a>
        </div>
      </div>
    </div>
  </div>
  <div class="relative overflow-x-auto">
    <table class="w-full text-sm text-left rtl:text-right text-gray-500 dark:text-gray-400">
      <thead class="text-xs text-gray-700 uppercase bg-gray-50 dark:bg-gray-700 dark:text-gray-400">
        <tr>
          <th scope="col" class="px-6 py-3">
            Date
          </th>
          <th scope="col" class="px-6 py-3">
            Description
          </th>
          <th scope="col" class="px-6 py-3">
            Category
          </th>
          <th scope="col" class="px-6 py-3">
            Amount
          </th>
          <th scope="col" class="px-6 py-3">
            Type
          </th>
          <th scope="col" class="px-6 py-3">
            Account
          </th>
          <th scope="col" class="px-6 py-3">
            Bank
          </th>
          <th></th>
        </tr>
      </thead>
      <tbody>
        <% @transactions.each do |transaction| %>
          <%= render('transactions/transaction_row', transaction: transaction, references: @user_references) %>
        <% end %>
      </tbody>
    </table>
    <div class="flex bg-white justify-center p-6">
      <% if @page.first? %>
        <button disabled class="flex items-center justify-center px-4 h-10 me-3 text-base font-medium text-gray-500 bg-white border border-gray-300 rounded-lg hover:bg-gray-100 hover:text-gray-700">
          <%= render 'icons/pointer-left' %>
          Previous
        </button>
      <% else %>
        <a href="<%= transactions_path(page: @page.next_param - 2, filter: params[:filter]&.to_unsafe_hash) %>" class="flex items-center justify-center px-4 h-10 me-3 text-base font-medium text-gray-500 bg-white border border-gray-300 rounded-lg hover:bg-gray-100 hover:text-gray-700">
          <%= render 'icons/pointer-left' %>
          Previous
        </a>
      <% end %>
      <% if @page.last? %>
        <button disabled class="flex items-center justify-center px-4 h-10 me-3 text-base font-medium text-gray-500 bg-white border border-gray-300 rounded-lg hover:bg-gray-100 hover:text-gray-700">
          Next
          <%= render 'icons/pointer-right' %>
        </button>
      <% else %>
        <a href="<%= transactions_path(page: @page.next_param, filter: params[:filter]&.to_unsafe_hash) %>" class="flex items-center justify-center px-4 h-10 text-base font-medium text-gray-500 bg-white border border-gray-300 rounded-lg hover:bg-gray-100 hover:text-gray-700">
          Next
          <%= render 'icons/pointer-right' %>
        </a>
      <% end %>
    </div>
  </div>
  <div id="background_processing_modal"></div>
</div>
